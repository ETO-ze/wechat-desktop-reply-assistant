# 使用指南

本指南介绍如何使用 **WeChat 桌面回复助手** 进行半自动化回复，并解释脚本运行时的主要流程和快捷键。

## 1. 快速上手

1. **启动 WeChat PC**：确保微信桌面端已登录并显示主窗口。
2. **运行脚本**：在虚拟环境中启动脚本 (`python wechat_auto_bot_single_v6_stable_resend.py`)。首次启动前请参照《安装指南》完成依赖安装与 OCR 区域校准。
3. **Arm 武装**：按 `Ctrl+Alt+S` 启动 *Arm* 模式（默认持续 10 分钟）。Arm 使脚本可以监听新消息并进行后续操作。
4. **开启自动回复**：按 `Ctrl+Alt+A` 切换 *AutoReply*。若开启，会在检测到新消息后调用 LLM 生成草稿。
5. **手动确认发送**：当 `confirm_before_send=true`（默认）时，脚本会等待你按 `Ctrl+Alt+Y` 才会真正发送回复。此设计用于避免自动向对方发送未经确认的内容。

## 2. 快捷键一览

| 快捷键        | 功能说明                                             |
|---------------|------------------------------------------------------|
| **Ctrl+Alt+S** | Arm 开关（10 分钟后自动失效）                       |
| **Ctrl+Alt+A** | AutoReply 开关（需 Arm 后才能生效）                |
| **Ctrl+Alt+G** | 手动发送剪贴板内容（需 Arm）                       |
| **Ctrl+Alt+Y** | 确认发送待发送回复（`confirm_before_send=true`） |
| **Ctrl+Alt+C** | 截取校准截图（整窗/标题区/消息区）                 |
| **Ctrl+Alt+R** | 重置当前会话（清空历史/去重状态）                 |
| **Ctrl+Alt+Q** | 紧急退出脚本                                       |
| **Ctrl+Alt+1..0** | 手动切换会话槽，当 title OCR 不稳定时备用       |

> 默认没有实现全自动发送；你仍需要按 `Ctrl+Alt+Y` 确认后才会发送。

## 3. 工作流程

1. 当脚本检测到消息区域左侧出现新消息时，将通过 **画面差分门控** 和 **OCR 稳定性** 多层判定确保不是重复或误触发。
2. 若启用了自动回复（AutoReply）并且 Arm 处于开启状态，脚本将调用配置的 LLM（默认为 Google Gemini OpenAI 兼容模型）生成回复草稿。
3. 草稿将粘贴到微信输入框中，但 **不会直接发送**。若 `confirm_before_send=true`，则等待你按下 `Ctrl+Alt+Y` 发送。如果你将其改为 `false`，则自动发送，风险更高。
4. 发送后脚本会短暂抑制再次触发，以防 UI 变化导致连续触发。

## 4. 使用建议

- **始终手动确认**：推荐保持 `confirm_before_send=true`，通过 `Ctrl+Alt+Y` 确认，避免误发送内容。
- **单聊优先**：该工具更适合处理点对点聊天。群聊或红包提醒等系统消息可能导致误触发。
- **注意安全**：自动回复可能违背平台条款或触发风控，请谨慎使用，严格控制频率和内容。
- **会话路由**：在稳定版本中，脚本会通过 OCR 提取聊天标题自动选择会话。在标题 OCR 不稳定时，可以用 `Ctrl+Alt+1..0` 手动切换会话槽。

## 5. 配置亮点

一些可调参数可在 `wechat_auto_bot_config.json` 中修改：

- `poll_interval_sec`：调整轮询频率，值越小检测越频繁。
- `auto_reply.cooldown_sec`：每次回复后冷却时间，避免频繁触发。
- `incoming_detection.split_left_ratio` 和 `overlap_ratio`：控制消息区域左右分割，减少将自己消息识别为对方消息。
- `session_routing.stability_required`：标题 OCR 连续命中的次数，提高该值可减少抖动带来的会话切换。

调整这些参数可以根据你电脑和微信界面的实际情况优化性能和准确率。如需进一步了解每个参数的作用，请查阅代码中的注释和主 README。

## 6. 退出脚本

按 `Ctrl+Alt+Q` 可以随时终止脚本。注意：退出前请确保所有待发送的回复已经确认发送或已取消，以免出现残余文本。

---

有关进阶配置、API 价格和常见问题，请参阅仓库中其他文档。
